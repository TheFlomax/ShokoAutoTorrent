services:
  shoko-auto-torrent:
    image: ghcr.io/theflomax/shokoautotorrent:latest
    build:
      context: .
      dockerfile: Dockerfile
    container_name: shoko-auto-torrent
    restart: unless-stopped

    env_file:
      - .env
    environment:
      # Fallbacks if not provided in .env
      SHOKO_URL: ${SHOKO_URL}
      SHOKO_API_KEY: ${SHOKO_API_KEY}
      QBIT_URL: ${QBIT_URL}
      QBIT_USERNAME: ${QBIT_USERNAME}
      QBIT_PASSWORD: ${QBIT_PASSWORD}
      SAVE_ROOT: ${SAVE_ROOT:-/data/anime}
      DRY_RUN: ${DRY_RUN:-true}
      SCHEDULE_INTERVAL_HOURS: ${SCHEDULE_INTERVAL_HOURS:-24}

    volumes:
      - ./cache:/app/.cache
      - ./config.yaml:/app/config.yaml:ro

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

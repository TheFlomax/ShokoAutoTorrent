services:
  shoko-auto-torrent:
    image: ghcr.io/theflomax/shokoautotorrent:latest
    build:
      context: .
      dockerfile: Dockerfile
    container_name: shoko-auto-torrent
    restart: unless-stopped

    env_file:
      - .env
    environment:
      # Fallbacks if not provided in .env
      SHOKO_URL: ${SHOKO_URL}
      SHOKO_API_KEY: ${SHOKO_API_KEY}
      QBIT_URL: ${QBIT_URL}
      QBIT_USERNAME: ${QBIT_USERNAME}
      QBIT_PASSWORD: ${QBIT_PASSWORD}
      SAVE_ROOT: ${SAVE_ROOT:-/data/anime}
      DRY_RUN: ${DRY_RUN:-true}
      EARLY_EXIT: ${EARLY_EXIT:-true}
      SCHEDULE_INTERVAL_HOURS: ${SCHEDULE_INTERVAL_HOURS:-24}
      # Shoko update options
      SHOKO_UPDATE_SERIES_STATS: ${SHOKO_UPDATE_SERIES_STATS:-true}
      SHOKO_UPDATE_WAIT_SECONDS: ${SHOKO_UPDATE_WAIT_SECONDS:-20}
      DISCORD_BOT_TOKEN: ${DISCORD_BOT_TOKEN}
      DISCORD_ALLOWED_USER_IDS: ${DISCORD_ALLOWED_USER_IDS}

    volumes:
      - config:/app/config
      # Optional: bind a local file instead of the named volume
      # - ./config.yaml:/app/config/config.yaml:ro

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  config:
